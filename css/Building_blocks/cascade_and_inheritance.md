# カスケードと継承

> 参考：https://developer.mozilla.org/ja/docs/Learn/CSS/Building_blocks/Cascade_and_inheritance

このページでは、最も基本的な概念（カスケード・詳細度・継承）について紹介します。

## 競合するルール

CSSは**Cascading Style Sheets**の略で、最初の単語であるcascadingを理解することは非常に重要です。カスケードの振る舞いは、CSSを理解するための鍵となり得ます。

要素に適用されているはずのCSSが機能していないと感じる場合、大抵は同じ要素に適用される可能性のある2つのルールを作ってしまったことに由来するものです。これは、カスケードおよびそれと密接に関連する詳細度の概念が関係しています。

この他に重要なのは継承という概念です。一部のCSSプロパティは親要素の値をデフォルトで継承し、一方で継承しないものもあります。これにより予期しない動作が発生する可能性もあります。

### カスケード

カスケードについて、シンプルに考えるならCSSルールの順序が重要であることを意味します。等しい小サイドを持つ2つのルールが適用される場合、CSSの最後にくるものが使用されます。

```html
<style>
  h1 {
    color: red;
  }
  
  h1 {
    color: blue;
  }
</style>

<h1>
  This Text color is blue.
</h1>
```

### 詳細度

複数のルールに異なるセレクタがある場合にブラウザがどのルールを適用するかを決定する方法ですが、同じ要素に適用することもできます。基本的に、セレクターの選択がどの程度具体的になるかの尺度です。

- 要素セレクタはそれほど具体的ではありません。ページに表示されるそのタイプのすべての要素を選択するため、スコアが低くなります。
- クラスセレクタはより具体的です。ページ上の特定のclass属性を持つ要素のみを選択するため、スコアは高くなります。

```html
<style>
  .main-heading {
    color: red;
  }
  
  h1 {
    color: blue;
  }
</style>

<h1 class="main-heading">
  Thie Text color is red.
</h1>
```

### 継承

親要素に設定されたCSSプロパティ値には、小要素に継承されるものとそうでないものがあります。

例えば、要素にcolorプロパティを設定すると、異なる色とフォントの値を直接適用しない限り、中のすべての要素がその色にスタイルされます。
あと、いくつかのプロパティでは継承はされません。`width: 50%;`と設定した場合、すべての子孫要素は親の幅50％の幅を取得しません。

## これらの概念がどう連携するか理解する

これら3つの概念は、どのCSSをどの要素に適用するかを一緒に制御します。以下のセクションでは、それらがどのように連携するかを見ていきます。

### 継承を理解する

下記の例では、幅、マージン、パディング、境界線（border）などは継承されません。もしそれらが継承されるとなると入れ子のすべてのリストとアイテムは境界線を表示してしまうことになります。

```html
<style>
  .main {
    color: purple;
    border: 1px solid black;
    padding: 1rem;
  }
</style>

<ul class="main">
  <li>item 1</li>
  <li>
    item 2
    <ul>
      <li>2.1</li>
      <li>2.2</li>
    </ul>
  </li>
  <li>
    item 3
    <ul>
      <li>
        3.1
        <ul>
          <li>3.1.1</li>
          <li>3.1.2</li>
        </ul>
      </li>
      <li>3.2</li>
    </ul>
  </li>
</ul>
```

### 継承の制御

CSSは、継承を制御するための4つの特別なユニバーサルプロパティ値を提供します

- inherit
  - 選択した要素に適用されるプロパティ値を、その親要素と同じものに設定します。
- initial
  - 選択された要素に適用されるプロパティ値を、ブラウザのデフォルトスタイルシートでその要素に設定されているものと同じ値に設定します。
    ブラウザーのデフォルトのスタイルシートで値が設定されておらず、かつ、そのプロパティが自然に継承される場合は `inherit` が代わりにプロパティ値として設定されます。
- unset
  - プロパティを自然な値にリセットします。つまり、プロパティが自然に継承される場合は`inherit`のように動作し、そうでない場合は`initial`のように動作する。
- revert
  - 新しい値で、これはブラウザのサーポートが制限されている。

上記の違いがわかる簡単な例

```html
<style>
	body {
		color: green;
  }

	.color-inherit a {
		color: inherit;
	}

	.color-reset a {
    color: initial;
	}

	.color-unset a {
    color: unset;
	}	
</style>
	
<ul>
	<li>Default <a href="#">link</a> color</li>
	<li class="color-inherit">Inherit the <a href="#">link</a> color</li>
  <li class="color-reset">Reset the <a href="#">link</a> color</li>
	<li class="color-unset">Unset the <a href="#">link</a> color</li>
</ul>
```

### すべてのプロパティ値のリセット

CSSの一括指定プロパティ`all`を使用して、これらの継承値の1つを（ほぼ）すべてのプロパティに一度に適用できます。

```html
<style>
  ul {
    all: unset;
  }
</style>

<ul>
  <li>hoge</li>
  <li>bar</li>
</ul>
```

## カスケードを理解する

スタイルを設定できるものが複数ある場合に、カスケードがどのようにしてCSSルールを適用していくか紹介します。

**考慮すべき3つの要因**（重要度の高い順にリスト）。

1. 重要性（Importance）
2. 詳細度（Specificity）
3. ソースオーダー（Source order）

### ソースオーダー

CSSコードで最後に書かれたルールが優先される、要素のスタイルを上書きしていく規則のこと

### 詳細度

要素セレクターよりクラスセレクターが優先されるような規則のこと。これらが両方定義されている場合、上書きされるのは「ルール」ではなく「プロパティ」のみ上書きされる。

詳細度の計算方法。ポイント単位の値で与えられ、ポイントの合計で詳細度が決められる。
単位は、1000, 100, 10, 1の位で表す。

**スコアされる条件**

- 1000の位は、宣言がstyle属性（インラインスタイル）内にある場合。
- 100の位は、全体のセレクタの内部にIDセレクタがある場合。
- 10の位は、全体のセレクタの内部にクラス・属性・擬似クラスがある場合。
- 1の位は、全体のセレクタの内部に要素セレクタ・擬似要素がある場合。

| セレクタ                       | 1000 | 100  | 10   | 1    | 詳細度の<br />合計 |
| ------------------------------ | ---- | ---- | ---- | ---- | ------------------ |
| h1                             | 0    | 0    | 0    | 1    | 0001               |
| h1 + p::first-letter           | 0    | 0    | 0    | 3    | 0003               |
| li > a[href*="en-US"] > .class | 0    | 0    | 2    | 2    | 0022               |
| #identifier                    | 0    | 1    | 0    | 0    | 0100               |
| インラインスタイルのみ         | 1    | 0    | 0    | 0    | 1000               |

> 注意として例えば、100個のクラスセレクタを組み合わせても、1つのIDセレクタのルールを上書きはできない。

### !important

上記の詳細度の計算を無効にする特別なCSSがあります。使用には十分注意してください。`!important`という特定のプロパティとその値を最も重要であると指定するものです。

これは便利ではありますが、必要な場合を除きあまりお勧めしません。なぜなら通常のカスケードの挙動とは異なるため、デバッグが困難になるためです。

使用しなければならない状況の1つに、コアにあるCSSモジュールを編集できないCMSで作業しているなどで他の方法では難しい場合や、スタイルを実際にオーバーライドしたい場合、などがあります。

## CSSロケーションの効果

CSS宣言の重要性は指定されたスタイルシートに依存します。ユーザはカスタムスタイルシートを設定して、開発者のスタイルをオーバーライドできます。

### 要約

競合する宣言は次の順序で適用され、後の方が前のものを上書きします。

1. ユーザーエージェントのスタイルシートの宣言。例えば、ブラウザー標準のスタイルなど。
2. ユーザースタイルシートの通常の宣言 (ユーザーが設定したカスタムスタイル)
3. 作者のスタイルシートでの通常の宣言 (私たちウェブ開発者によって設定されたスタイルのことです)
4. 作者のスタイルシートの重要 *(important)* な宣言
5. ユーザーのスタイルシートの重要 *(important)* な宣言
