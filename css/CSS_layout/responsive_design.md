# レスポンシブデザイン

> 参考：https://developer.mozilla.org/ja/docs/Learn/CSS/CSS_layout/Responsive_Design

このページでは、さまざまな画面幅、解像度などに合わせて、Webページがレイアウトと外観を変換できるようにするレスポンシブデザイン（Responsive Web Design, RWD）について見ていきます。

## 歴史的なWebサイトのレイアウト

昔のウェブサイトを設計するときの選択肢は、

- ブラウザのウィンドウに合わせて伸縮するリキッド（液状）のサイト
- ピクセル単位の固定サイズによる固定幅のサイト

の2つでした。これらは、サイトを設計する側の画面では見栄えが良いです。しかし、

リキッドのサイトは、小さな画面では押しつぶされたデザインになり、大きな画面では読みにくいほど長い文字列になります。 [リキッドのサイト（mdn.github.io）](https://mdn.github.io/css-examples/learn/rwd/liquid-width.html)

固定幅のサイトでは、画面幅が小さいと水平スクロールバーが発生するリスクがあり、大きな画面ではデザインの端に多くの空白が発生します。[固定幅のサイト（mdn.github.io）](https://mdn.github.io/css-examples/learn/rwd/fixed-width.html)

モバイルWebが多機能携帯電話で普及し始めた頃、モバイルを採用したい企業は異なるURL（m.example.com, example.mobiなど）を使用してサイトの特別なモバイルバージョンを作成していました。これにはサイトを2つの異なるバージョンとして開発し、最新の状態に保たなくてはなりませんでした。

これは、フル機能のデスクトップバージョンとフル機能でないモバイルバージョンが出てくるようになり、デスクトップバージョンを知るモバイルユーザにとっては面白くないことになりました。

## レスポンシブデザインより前のフレキシブルレイアウト

Webサイトを構築する際のリキッド、固定幅の欠点を解決するために多くのアプローチが開発されました。

2004年にはCameron Adams著の[Resolution dependent layout](https://www.themaninblue.com/writing/perspective/2004/09/21/)という題名の投稿を書き、さまざまな画面解像度に適応できるデザインを作成する方法を説明しました。しかし、このアプローチには画面解像度を検出し正しいCSSをロードするためにJavaScriptが必要でした。

Zoe Mickley Gillenwaterはフレキシブル（柔軟な）サイトを作成するさまざまな方法の説明と形式化をし、画面を埋めるか、サイズを完全に固定するかの間で妥協点を見つけるために[尽力しました](http://zomigi.com/blog/voices-that-matter-slides-available/)。

## レスポンシブデザイン

レスポンシブデザインという用語は、2010年にEthan Marcotteによって初めて作られ、3つのテクニックを組み合わせて使用することを説明しています。URL：[Responsive Web Design ](https://alistapart.com/article/responsive-web-design/)

1. フルード（流動的な）グリッドのアイデア。URL： [Fluid Grids](https://alistapart.com/article/fluidgrids/)
2. フルード画像のアイデア。これは`max-width: 100%;`にするテクニックです。しかしこれは画像が含まれる列が本来のサイズより狭くなった場合、画像は小さく縮小されますが、大きくなることがないことです。URL：[Fluid Images](https://unstoppablerobotninja.com/entry/fluid-images/)
3. メディアクエリー。これは、上記でCameron AdamsがJavaScriptを使用してレイアウトの切り替えを行ったものを、CSSのみを使用して切り替えを行うものです。

レスポンシブWebデザインは独立した技術ではありません。これはコンテンツの表示に使用されるデバイスに対応するレイアウトに対する、Webデザインへのアプローチ、またはベストプラクティスのセットを説明する用語です。

Marcotteの最初の検討では、柔軟なグリッド（フロートを使用）とメディアクエリーを意味していましたが、上記の記事が書かれてから10年以上で、レスポンシブに動作することがデフォルトとなりました。

ここからはレスポンシブサイトを作成するときに使用するさまざまなWebプラットフォーム機能について見ていきます。

## メディアクエリー

レスポンシブデザインは、メディアクエリーによって出現できました。Media Queries Level 3仕様は2009年に勧告候補になりました。つまりブラウザでの実装の準備が整ったということです。

メディアクエリを使用すると、一連のテスト（ユーザの画面が特定の幅、特定の解像度より大きいかどうか）を実行し、CSSを選択的に適用して、ユーザのニーズに合わせて適切にページをスタイルできます。

下記では、現在のWebページが画面のメディア（印刷ドキュメントではない）として表示され、ビューポートの幅が少なくとも800pxであるかどうかテストします。この2つが当てはまる場合のみ、ルールが適用されます。

```css
@media screen and (min-width: 800px) {
  .container {
    margin: 1rem;
  }
}
```

メディアクエリーが導入され、レイアウトが変更されるポイントは、ブレイクポイント（breakpoints）と呼ばれます。

メディアクエリーを使用する一般的なアプローチは、狭い画面のデバイス（携帯電話など）用に単純な単一列レイアウトを作成し、次により大きな画面かチェックして複数列レイアウトを処理するのに十分な画面幅があれば、複数列レイアウトを実装することです。これはモバイルファーストデザイン（Mobile First Design）と呼ばれます。

詳細は、[メディアクエリー（mdn）](https://developer.mozilla.org/ja/docs/Web/CSS/Media_Queries)をご覧ください。

### フレキシブルグリッド

レスポンシブサイトは、ブレイクポイント間でレイアウトを変更するだけでなく、フレキシブルグリッドに基づいて構築されます。

フレキシブルグリッド（柔軟なグリッド）とは、あらゆるサイズのデバイスをターゲットとし、それらのデバイスのサイズに合わせて完璧なレイアウトを構築する必要がないことです。

サイズの異なるデバイスは膨大に存在しますし、デスクトップではユーザは常にブラウザのウィンドウを最大化しているわけではありません。

フレキシブルグリッドを使用することで、ブレイクポイントを追加し、コンテンツの見た目が悪くなり始めた時点でデザインを変更するだけですみます。

レスポンシブデザインの初期には、レイアウトを行う唯一の方法はフロートを使用することでした。柔軟なフロートレイアウトは、各要素に幅をパーセントで指定し、レイアウト全体で合計が100%を超えないようにすることで実現します。

式は次の通りです。targetは列、contextはコンテナです。

```css
/* target / context = result */
.col {
  width: 6.25%; /* 60 / 960 = 0.0625 */
}
```

このアプローチは、webの多くの場所で見ることができます。[フロート（mdn.github.io）](https://mdn.github.io/css-examples/learn/rwd/float-based-rwd.html)

## 最新のレイアウト技術

段組みレイアウト、フレックスボックス、グリッドのレイアウト方法は、デフォルトでレスポンシブです。下記ではこれらのレイアウト方法をレスポンシブに行う方法を見ていきます。

**段組み（multicol）**

上記で説明したレイアウトの中で最も古いレイアウトはこの段組みレイアウトです。

`column-count`プロパティは、コンテンツを分割する列の数を指定します。ブラウザはこれらのサイズを計算し、サイズは画面サイズに応じて変化します。したがって、列の数は最初から決まっています。

`column-width`プロパティは、列の最小幅を指定します。ブラウザはその幅の列をコンテナに収まるだけ作成し、すべての列の間で残りのスペースを分配します。したがって、列の数はどのくらいのスペースがあるかに応じて変化します。

```css
.container {
  column-count: 3;
}

.container {
  column-width: 10em;
}
```

**フレックスボックス（flex box）**

フレックスボックスでは、フレックス項目の初期のふるまいは、コンテナ内のスペースに従って、項目間のスペースを縮小、分散します。`flex-grow, flex-shrink`を変更することにより、項目の周囲に多少のスペースがあった場合のふるまいを指定することもできます。

下記では、フレックスボックスを使用して、かつ`flex: 1`を定義して、フレックス項目をコンテナ内いっぱいの幅を取ります。

```css
.container {
  display: flex;
}

.item {
  flex: 1;
}
```

**グリッド（grid）**

グリッドレイアウトは、fr単位を使用して、トラック全体に利用可能なスペースを分散します。トラックが分散されることで、複数のトラックが作成され、それぞれがコンテナ内の使用可能なスペースを取得します。

下記では、グリッドレイアウトを使用して、サイズが3つの1frの値を持つコンテナを作成します。

```css
.container {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
}
```

## レスポンシブ画像

レスポンシブ画像に対する最も簡単なアプローチは、`max-width: 100%;`を画像に適用して、最大サイズの画像を取得し、縮小することです。

しかしこのアプローチには明らかな欠点があります。画像は本来のサイズよりも遥かに小さく表示される可能性があり、これは帯域幅の浪費です。

モバイルユーザはブラウザのウィンドウに表示されるサイズの数倍の画像をダウンロードすることになります。さらにモバイルとデスクトップで同じ画像アスペクト比を使用したくない場合があります。例えば、モバイルには正方形の画像を、デスクトップにはランドスケープ画像を使用したいなどです。

この問題は`picture`要素と、img要素の`srcset, size`属性を使用することで解決できます。画像に適切な画面サイズと解像度を記述するメタデータとともに複数のサイズを提供でき、ブラウザは各デバイスに最適な画像を選択し、ユーザが使用しているデバイスに適した画像サイズをダウンロードできるようにします。

さまざまなサイズで使用されるアートディレクション画像は、さまざまな画面サイズに対して、さまざまな切り抜き、またはまったく異なる画像を提供します。

## レスポンシブタイポグラフィ

これはメディアクエリー内のフォントサイズを変更して、画面を占める量を増減させることを表します。つまり、デスクトップとモバイルで表示する文字のサイズを最適にすることです。[レスポンシブタイポグラフィ（mdn.github.io）](https://mdn.github.io/css-examples/learn/rwd/type-rwd.html)

```css
html {
  font-size: 1em;
}

h1 {
  font-size: 2rem;
}

@media (min-width: 1200px) {
  h1 {
    font-size: 4rem;
  }
}
```

メディアクエリーをページのレイアウトの変更のみに制限する必要はありません。レスポンシブタイポグラフィのアプローチは、任意の要素を微調整し、代わりとなる画面サイズでより使いやすく魅力的にすることができます。

### レスポンシブタイポグラフィにビューポート単位を使用

興味深いアプローチとして、vwを使用してレスポンシブタイポブラフィを有効にすることです。`1vw`はビューポートの幅の1%なため、これをフォントサイズに設定すると、ビューポートのサイズに関連付けられます。

しかしvw単位を使用するとユーザがテキストをズームする機能を失います。なので、テキストにビューポート単位を単独で設定しないでください。

といいつつ解決策があり、`calc()`関数を使用して、`em, rem`などの固定サイズの値に`vw`単位を足すことです。

```css
h1 {
  font-size: calc(1.5rem + 3vw);
}
```

しかし個人的には分かりづらいので使いたくありません。

## ビューポートメタタグ

レスポンシブなページのHTMLソースを見るとheadの中にこのようなmetaタグがあります。

```html
<meta name="viewport" content="width=device-width,initial-scale=1">
```

これはモバイルブラウザに、ビューポートの幅をデバイスの幅に設定し、ドキュメントを意図したサイズの100%にスケーリングするよう指示します。これによりドキュメントはモバイル向けに最適化されたサイズで表示されます。

なぜこれが必要なのでしょう。それはモバイルブラウザにビューポートの幅について嘘をつく傾向があるためです。

このメタタグがあるのは最初のiPhoneが出て、小さな画面でWebサイトを見始めたとき、ほとんどのサイトがモバイル向けに最適化されていなかったためです。したがってモバイルブラウザはビューポートの幅を960pxに設定し、その幅でページをレンダリングし、デスクトップレイアウトの縮小板として結果を表示していました。

他のモバイルブラウザ（Google Androidなど）も同じようなことを行い、ユーザはWebサイトをズームインして画面内を移動したため見た目や使い勝手も悪かったです。

問題はモバイルブラウザでは、ブレイクポイントとメディアクエリーを使用したレスポンシブデザインが意図した通りに機能しないことです。

例えば、ビューポート幅が`480px`以下で作動するレイアウトで、ビューポートが`960px`で設定されている場合、モバイルで狭い画面のレイアウトが表示されることはありません。

`width=device-width`を設定すると、Appleのデフォルトの`width=960px`が上書きされるためメディアクエリは意図した通りに機能します。其の為に上記のビューポートメタタグが必要なのです。

**ビューポートメタタグで使用できる各種設定**

- `initial-scale`、ページの初期ズームを設定します。デフォルトは1です。
- `height`、ビューポートに特定の高さを設定します。
- `minimum-scale`、最小ズームレベルを設定します。
- `maximum-scale`、最大ズームレベルを設定します。
- `user-scalable`、noに設定すると、ズームを禁止します。

`minimum-scale, maximum-scale, user-scalable`をnoに設定することは避けてください。アクセシビリティに影響が生じます。

また`@viewport`というビューポートメタタグを置き換えるように設計されたCSSの＠規則がありますが、ブラウザのサポートが不十分です。

### まとめ

レスポンシブデザインとは、表示される環境に対応するサイト、またはアプリのデザインを指します。現在ではウェブサイトを構築する方法として当たり前となっています。デスクトップバージョンを縮小したサイトや、横にスクロールする必要のあるサイトに出会わないということは、webがレスポンシブデザインのアプローチに移行したためです。

ぜひレスポンシブデザインをマスターしましょう！
