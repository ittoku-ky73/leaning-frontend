# レスポンシブ画像

> 参考：[レスポンシブ画像](https://developer.mozilla.org/ja/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images)
>
> この記事では、レスポンシブ画像の概念、画面サイズ、解像度などの機能が大きく異なる機器で適切に動作する画像について学び、HTMLでどのように実装するのか見ていきます。
>
> レスポンシブ画像は、レスポンシブウェブデザインの一部に過ぎませんが、後々出てくるCSSのモジュールで多くのことを学ぶことができます。

## なぜレスポンシブ画像なのか

簡単な例

![picture-element-wide](https://mdn.mozillademos.org/files/12940/picture-element-wide.png)

このページはラップトップやデスクトップなどの広い画面のデバイスではうまく表示されます。

- 本文のコンテンツは、最大幅1200pxで設定されています
- ヘッダー画像は、ヘッダーがどのような幅でも、中心が常にヘッダーの中央に来るように設定されています。
- コンテンツ画像は、`body`要素が画像より狭くなると、溢れるのではなく縮小します。

次の例です。

![non-responsive-narrow](https://mdn.mozillademos.org/files/12936/non-responsive-narrow.png)

このページの問題点は、狭い画面のデバイスでサイトを表示する時に、コンテンツ画像が見えにくくなることです。この寸法では、中の人物がほとんど見えていません。

改良点は、狭い画面で見た時に切り取った画像を表示させることです。第二の切り取られた画像は、タブレットのような中幅のデバイス用に表示することができます。これを一般的に**アートディレクションの問題**として知られています。

さらに、小さなモバイル画面で見ている場合、大きな画像をページに埋め込む必要はありません。これは**解像度の切り替え問題**と呼ばれています。

逆に、意図した大きさよりもはるかに小さい画面に大きな画像を表示する必要はありません。帯域幅を無駄にすることがあります。
特にモバイルユーザーは、小さな画像がデバイスに表示される時、デスクトップ向けの大きな画像をダウンロードすることによる帯域幅の無駄を好みません。
理想的な状況は、複数の解像度が利用可能で、ウェブサイト上のデータにアクセスするデバイスに応じて適切なサイズを提供することです。

ベクター画像はある側面ではこれらの問題を解決すると思うかもしれません。なぜならファイルサイズが小さく容易に縮尺変更でき、どこでも利用できるからです。
しかし、すべての種類の画像に適しているわけではありません。

この種の問題は、90年代前半から中期のウェブが登場したての頃はありませんでした。
なぜならウェブをブラウズする唯一のデバイスは、デスクトップかラップトップであったため、ブラウザの技術者や仕様書の著者は解決策を実装することは考えませんでした。

レスポンシブ画像技術は上記のような問題を解決するために実装され、ピクセル数が異なるさまざまな画像（解像度の切り替え）、異なる領域の取り方が異なるさまざまな画像（アートディレクション）を含めることができます。

> ここで説明する新機能、`srcset | size | <picture>`はすべてのブラウザで対応しています（IE以外）。

## レスポンシブ画像の作り方

上で説明した二つの問題（解像度とアートディレクション）を踏まえ、HTMLのレスポンシブ機能を使用して解決する方法を示します。この節では`img`に注目します。

またサイトヘッダーの画像は単なる装飾なので、CSS背景画像を使用して実装します。

### 解像度の切り替え：さまざまな寸法

標準的なimg要素は、伝統的にブラウザにソースファイルを一つだけしか指定できません。

しかい、`srcset | sizes`を使用することで、複数のソース画像とサイズを設定することができます。

```html
<img srcset="elva-fairy-320w.jpg 320w,
             elva-fairy-480w.jpg 480w,
             elva-fairy-800w.jpg 800w"
     sizes="(max-width: 320px) 280px,
            (max-width: 480px) 440px,
            800px"
     src="elva-fairy-800w.jpg" alt="妖精の衣装を着たエルバ">
```

それぞれの値にはコンマ区切りのリストが設定されており、それぞれのリストの部分は3つの部分からなっています。

**定義する条件**

- srcset
  - 画像ファイル名(elva-fairy-320w.jpg)
  - 空白
  - 画像の本質的な幅のピクセル数（320w）。単位にpxではなくwを使用します。これは画像の実際の寸法で、画像ファイルを調べるとわかります。
- sizes
  - メディア条件(max-width: 320px)、この場合「ビューポートの幅が320px以下である時」と言っています。
  - 空白
  - メディア条件が成立した時に**埋めるスロットの幅（320px）**
    スロットの幅については、絶対的な長さ（px, em）と相対的な長さ（パーセント値など）で指定することができます。

**ブラウザが見る順番**

1. そのデバイスの幅を見る。
2. `sizes`リストの中のどのメディア条件が真であるかを確認する。
3. そのメディア紹介で与えられたスロットサイズを見る。
4. 選択したスロットサイズに最も近い`srcset`リストで参照される画像を読み込む。

> HTMLドキュメントの`head`には、`<meta name="viewport" content="width=device-width">` という行があります。
>
> これは、モバイルブラウザがWebページを読み込むために実際のビューポート幅を使用するように強制するものです。

### 便利な開発者ツール

ブラウザには必要なスロット幅などの作業に役立つ幾つかの便利な**開発者ツール**があります。
これはフロントエンド開発をする上で重要なツールです。

### 解像度の切り替え：同じサイズ、異なる解像度

複数の画面解像度をサポートして、誰もが画面上で同じ実世界サイズで画像を見る場合、
`sizes`を指定せず、x記述子を指定した`srcset`を使用すれば、ブラウザに適切な解像度の画像を選択させることができます。

```html
<img srcset="elva-fairy-320w.jpg,
             elva-fairy-480w.jpg 1.5x,
             elva-fairy-640w.jpg 2x"
     src="elva-fairy-640w.jpg" alt="妖精の衣装を着たエルバ">
```

```css
img {
  width: 320px;
}
```

この場合、`sizes`は必要ありません。
ブラウザは表示されている画面がどの解像度であるかを調べ、`srcset`で参照されている最も適切な画像を提供するからです

### アートディレクション

アートディレクションの問題は、表示する画像を、異なる画像表示サイズに合うように変更したい場合おこります。

そういうことは`picture`要素を使うことで解決します。

```html
<picture>
  <source media="(max-width: 799px)" srcset="elva-480w-close-portrait.jpg">
  <source media="(min-width: 800px)" srcset="elva-800w.jpg">
  <img src="elva-800w.jpg" alt="クリスは立って彼の娘エルバを保持します">
</picture>
```

- source要素にはメディア条件の入った`media`属性が含まれています。
  この場合、「ビューポート幅が799ピクセルの幅以下の場合`true`」となり、最初の画像が表示されます
- srcset属性には、表示する画像へのパスが含まれます。
- img要素は、上のメディア条件でどれも`true`を返さなかった場合に、画像を表示します。

### なぜCSSやJavaScriptを使って実装ができないのか

それはブラウザが読み込む順番にあります。

CSSとJavaScriptを読み込む前に画像のダウンロードを開始してしまうからです。

### 現代の画像フォーマットを大胆に使用する

小さなファイルサイズと高品質を同時に維持できる、エキサイティングな新しい画像フォーマット（WebP, PEG-2000など）がいくつかあります。

しかし、ブラウザのサポートにムラがあります。

```html
<picture>
  <source type="image/svg+xml" srcset="pyramid.svg">
  <source type="image/webp" srcset="pyramid.webp">
  <img src="pyramid.png" alt="4つの正三角形から構築された通常のピラミッド">
</picture>
```

